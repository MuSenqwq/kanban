<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:include="include :: header('新建团队')" />
    <th:block th:include="include :: select2-css" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        body { background: #fff; padding: 30px; font-family: -apple-system, sans-serif; }
        .form-header { text-align: center; margin-bottom: 30px; }
        .form-title { font-size: 20px; font-weight: 700; color: #172b4d; }
        .form-desc { font-size: 13px; color: #6b778c; margin-top: 5px; }

        .modern-group { margin-bottom: 25px; }
        .modern-label { display: block; font-weight: 600; color: #42526e; margin-bottom: 8px; font-size: 14px; }

        .modern-input {
            width: 100%; border: 2px solid #dfe1e6; background: #fafbfc; border-radius: 6px;
            padding: 10px 15px; font-size: 14px; transition: all 0.2s; outline: none;
        }
        .modern-input:focus { background: #fff; border-color: #0079bf; box-shadow: 0 0 0 3px rgba(0,121,191,0.1); }

        .btn-footer { display: flex; justify-content: flex-end; gap: 12px; margin-top: 40px; padding-top: 20px; border-top: 1px solid #ebecf0; }
        .btn-cancel { background: #ebecf0; color: #42526e; border: none; padding: 10px 20px; border-radius: 6px; font-weight: 600; cursor: pointer; }
        .btn-save { background: #0079bf; color: #fff; border: none; padding: 10px 24px; border-radius: 6px; font-weight: 600; cursor: pointer; box-shadow: 0 4px 6px rgba(0,121,191,0.2); }
    </style>
</head>
<body>

<div class="form-header">
    <div class="form-title">创建一个新团队</div>
    <div class="form-desc">填写基本信息，开始高效协作</div>
</div>

<form id="form-team-add">
    <div class="modern-group">
        <label class="modern-label">团队名称 <span style="color:#ff5630">*</span></label>
        <input type="text" name="teamName" class="modern-input" placeholder="例如：产品研发一部" required>
    </div>

    <div class="modern-group">
        <label class="modern-label">团队负责人</label>
        <select name="ownerId" class="form-control select2">
            <option value="">-- 请指派负责人 --</option>
            <option th:each="user : ${users}" th:value="${user.userId}" th:text="${user.userName}"></option>
        </select>
    </div>

    <div class="btn-footer">
        <button type="button" class="btn-cancel" onclick="closeModal()">取消</button>
        <button type="button" class="btn-save" onclick="submitHandler()"><i class="fa fa-check"></i> 立即创建</button>
    </div>
</form>

<th:block th:include="include :: footer" />
<th:block th:include="include :: select2-js" />

<script>
    var prefix = ctx + "ruoyi-kanban/team";

    function submitHandler() {
        var teamName = $("input[name='teamName']").val();
        if(!teamName) {
            Swal.fire({icon: 'warning', title: '提示', text: '团队名称不能为空'});
            return;
        }

        $.ajax({
            url: prefix + "/add",
            type: "post",
            data: $('#form-team-add').serialize(),
            success: function(res) {
                if (res.code === 0) {
                    Swal.fire({icon: 'success', title: '创建成功', showConfirmButton: false, timer: 1000}).then(() => {
                        if(parent.loadTeamList) parent.loadTeamList();
                        closeModal();
                    });
                } else {
                    Swal.fire({icon: 'error', title: '创建失败', text: res.msg});
                }
            }
        });
    }

    function closeModal() {
        var index = parent.layer.getFrameIndex(window.name);
        parent.layer.close(index);
    }
</script>
</body>
</html>