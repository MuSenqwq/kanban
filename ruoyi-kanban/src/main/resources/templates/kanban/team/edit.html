<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:include="include :: header('编辑团队')" />
    <th:block th:include="include :: select2-css" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        body { padding: 30px; background: #fff; font-family: -apple-system, sans-serif; }
        .form-header { margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px solid #ebecf0; }
        .form-title { font-size: 18px; font-weight: 700; color: #172b4d; }

        .modern-group { margin-bottom: 25px; }
        .modern-label { display: block; font-weight: 600; color: #42526e; margin-bottom: 8px; font-size: 14px; }

        .modern-input {
            width: 100%; border: 2px solid #dfe1e6; background: #fafbfc; border-radius: 6px;
            padding: 10px 15px; font-size: 14px; outline: none; transition: 0.2s;
        }
        .modern-input:focus { background: #fff; border-color: #0079bf; }

        .btn-footer { display: flex; justify-content: flex-end; gap: 12px; margin-top: 30px; }
        .btn-cancel { background: #f4f5f7; color: #333; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 600; }
        .btn-save { background: #0079bf; color: #fff; border: none; padding: 10px 24px; border-radius: 6px; cursor: pointer; font-weight: 600; box-shadow: 0 4px 6px rgba(0,121,191,0.2); }
        .btn-save:hover { background: #005a8e; transform: translateY(-1px); }
    </style>
</head>
<body>

<div class="main-content">
    <div class="form-header">
        <div class="form-title">编辑团队信息</div>
    </div>

    <form id="form-team-edit" th:object="${kbTeam}">
        <input name="teamId" th:field="*{teamId}" type="hidden">

        <div class="modern-group">
            <label class="modern-label">团队名称 <span style="color:red">*</span></label>
            <input type="text" name="teamName" class="modern-input" th:field="*{teamName}" required>
        </div>

        <div class="modern-group">
            <label class="modern-label">负责人</label>
            <select name="ownerId" class="form-control select2" th:field="*{ownerId}">
                <option value="">-- 请选择负责人 --</option>
                <option th:each="user : ${users}"
                        th:value="${user.userId}"
                        th:text="${user.userName}"></option>
            </select>
        </div>

        <div class="btn-footer">
            <button type="button" class="btn-cancel" onclick="closeModal()">取消</button>
            <button type="button" class="btn-save" onclick="submitHandler()"><i class="fa fa-check"></i> 保存更改</button>
        </div>
    </form>
</div>

<th:block th:include="include :: footer" />
<th:block th:include="include :: select2-js" />

<script>
    var prefix = ctx + "ruoyi-kanban/team";

    $(function() {
        if ($.fn.select2) {
            $(".select2").select2();
        }
    });

    function submitHandler() {
        var name = $("input[name='teamName']").val();
        if(!name) {
            Swal.fire({icon: 'warning', title: '提示', text: '团队名称不能为空'});
            return;
        }

        $.ajax({
            url: prefix + "/edit",
            type: "post",
            data: $('#form-team-edit').serialize(),
            success: function(res) {
                if (res.code === 0) {
                    Swal.fire({icon: 'success', title: '保存成功', showConfirmButton: false, timer: 1000}).then(() => {
                        if(parent.window.loadTeamList) parent.window.loadTeamList();
                        else parent.location.reload();
                        closeModal();
                    });
                } else {
                    Swal.fire({icon: 'error', title: '保存失败', text: res.msg});
                }
            }
        });
    }

    function closeModal() {
        var index = parent.layer.getFrameIndex(window.name);
        parent.layer.close(index);
    }
</script>
</body>
</html>