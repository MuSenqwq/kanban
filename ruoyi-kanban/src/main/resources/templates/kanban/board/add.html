<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:include="include :: header('新建看板')" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        body { background: #fff; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; padding: 20px 30px; }
        .form-header { margin-bottom: 25px; text-align: center; }
        .form-header h3 { font-weight: 700; color: #172b4d; margin: 0; }
        .form-header p { color: #6b778c; font-size: 13px; margin-top: 5px; }

        .modern-group { margin-bottom: 20px; }
        .modern-label { display: block; font-size: 13px; font-weight: 600; color: #42526e; margin-bottom: 8px; }

        .modern-input {
            width: 100%; border: 2px solid #dfe1e6; background: #fafbfc;
            border-radius: 6px; padding: 10px 12px; font-size: 14px; color: #172b4d;
            transition: all 0.2s; outline: none;
        }
        .modern-input:focus { background: #fff; border-color: #0079bf; box-shadow: 0 0 0 2px rgba(0,121,191,0.1); }
        .modern-textarea { min-height: 80px; resize: vertical; }

        /* 颜色选择器 */
        .color-options { display: flex; gap: 10px; margin-top: 5px; }
        .color-opt { width: 30px; height: 30px; border-radius: 50%; cursor: pointer; transition: transform 0.2s; position: relative; border: 2px solid transparent; }
        .color-opt:hover { transform: scale(1.1); }
        .color-opt.active { border-color: #172b4d; transform: scale(1.1); }
        .color-opt.active::after { content: '\f00c'; font-family: FontAwesome; color: rgba(255,255,255,0.8); position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 12px; }

        .btn-group-footer { margin-top: 30px; display: flex; justify-content: flex-end; gap: 10px; }
        .btn-modern { border: none; padding: 10px 24px; border-radius: 6px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .btn-cancel { background: #ebecf0; color: #42526e; }
        .btn-cancel:hover { background: #dfe1e6; }
        .btn-save { background: #0079bf; color: #fff; box-shadow: 0 4px 6px rgba(0,121,191,0.2); }
        .btn-save:hover { background: #026aa7; transform: translateY(-1px); }
    </style>
</head>
<body>

<div class="main-content">
    <div class="form-header">
        <h3>创建新看板</h3>
        <p>为你的团队或项目创建一个可视化的工作空间</p>
    </div>

    <form id="form-board-add">
        <div class="modern-group">
            <label class="modern-label">看板名称 <span style="color:red">*</span></label>
            <input type="text" name="boardName" class="modern-input" placeholder="例如：Q4 产品研发、市场推广计划..." required autocomplete="off">
        </div>

        <div class="modern-group">
            <label class="modern-label">主题颜色</label>
            <input type="hidden" name="themeColor" id="themeColor" value="#0079bf">
            <div class="color-options">
                <div class="color-opt active" style="background:#0079bf;" onclick="selectColor(this, '#0079bf')"></div>
                <div class="color-opt" style="background:#d29034;" onclick="selectColor(this, '#d29034')"></div>
                <div class="color-opt" style="background:#519839;" onclick="selectColor(this, '#519839')"></div>
                <div class="color-opt" style="background:#b04632;" onclick="selectColor(this, '#b04632')"></div>
                <div class="color-opt" style="background:#89609e;" onclick="selectColor(this, '#89609e')"></div>
                <div class="color-opt" style="background:#cd5a91;" onclick="selectColor(this, '#cd5a91')"></div>
            </div>
        </div>

        <div class="modern-group">
            <label class="modern-label">简介描述</label>
            <textarea name="intro" class="modern-input modern-textarea" placeholder="简要说明这个看板的用途..."></textarea>
        </div>

        <div class="btn-group-footer">
            <button type="button" class="btn-modern btn-cancel" onclick="closeModal()">取消</button>
            <button type="button" class="btn-modern btn-save" onclick="submitForm()"><i class="fa fa-check"></i> 立即创建</button>
        </div>
    </form>
</div>

<th:block th:include="include :: footer" />
<script>
    var prefix = ctx + "kanban/board";

    function selectColor(el, color) {
        $('.color-opt').removeClass('active');
        $(el).addClass('active');
        $('#themeColor').val(color);
    }

    function submitForm() {
        var boardName = $("input[name='boardName']").val();
        if(!boardName) {
            Swal.fire({ icon: 'warning', title: '请输入看板名称', toast: true, position: 'top', timer: 2000, showConfirmButton: false });
            return;
        }

        $.ajax({
            url: prefix + "/add",
            type: "post",
            data: $('#form-board-add').serialize(),
            beforeSend: function() {
                $(".btn-save").attr('disabled', true).html('<i class="fa fa-spinner fa-spin"></i> 创建中...');
            },
            success: function(res) {
                if (res.code === 0) {
                    Swal.fire({ icon: 'success', title: '创建成功', showConfirmButton: false, timer: 1000 }).then(() => {
                        // 刷新父窗口并关闭
                        if(parent.refreshGrid) parent.refreshGrid();
                        else if(parent.search) parent.search(); // 兼容若依默认
                        closeModal();
                    });
                } else {
                    Swal.fire({ icon: 'error', title: '失败', text: res.msg });
                    $(".btn-save").attr('disabled', false).html('<i class="fa fa-check"></i> 立即创建');
                }
            }
        });
    }

    function closeModal() {
        var index = parent.layer.getFrameIndex(window.name);
        parent.layer.close(index);
    }
</script>
</body>
</html>